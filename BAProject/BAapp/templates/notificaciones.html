{% extends 'base.html' %}
{% block imports %}
{% load static %}
{% load auth_extras %}
{% endblock imports %}
{% block style%}
{% endblock style%}
{% block title %}
BuenaVentura Agronegocios
{% endblock title %}
{%block body%}


<head>
    <link rel="stylesheet" type="text/css" href="{% static '/css/old_vendedor.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static '/css/pages.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static '/css/notificaciones.css' %}">
</head>

<body>


    <div id="modalDetalleNegocio" class="modal">
        <div id="modalNegocio" class="modal-content">
        </div>
    </div>

    <div class="row">

        <div style="height: 110px;">

            <div style="height: 60px;" class="menu col l4 m4 s4 clv">
                <div>
                    <div class="col-s2 h-bar circule">
                        <i class="medium material-icons"
                            style="position: relative; color:#005221;">notifications_none</i>
                    </div>
                </div>
                <h4 class="col l9 s9" style="margin:0; font-weight: 300;"> Notificaciones</h4>
            </div>
        </div>

        <div class="clv">

            <div style="width: 100%;">
                <!----------------Titulitos ------------------->
                <div class="col s4 l4 bloque-izquierdo clvP">
                    <div class="titulos">
                        <span class=" titulito">
                            Presupuestos
                        </span>
                        <img class="imgchica text-align left hide-on-small-only"
                            src="{% static 'images/presupuesto.png' %}">
                    </div>
                    <div class="nuevos">
                        <a>00</a>
                        <a>Nuevos</a>
                    </div>
                </div>
                <div class="col l4 s4 bloque-centro clvP">
                    <div class="titulos">
                        <span class="titulito">
                            Logística
                        </span>
                        <img class="imgchica text-align left hide-on-small-only"
                            src="{% static 'images/logistica.png' %}">
                    </div>
                    <div class="nuevos">
                        <a>00</a>
                        <a>Nuevos</a>
                    </div>
                </div>
                <div class="col l4 s4 bloque-derecho clvP">
                    <div class="titulos">
                        <span class="titulito">
                            Vencimientos
                        </span>
                        <img class="imgchica text-align left hide-on-small-only"
                            src="{% static 'images/vencimientos.png' %}">
                    </div>
                    <div class="nuevos">
                        <a>00</a>
                        <a>Nuevos</a>
                    </div>
                </div>
                <!------------------------------------------------------------------------------->

                <!------------notificaciones Prespuesto----------------------->
                <div class="col s4 tamaño" style="border-bottom: 2px solid rgb(128, 128, 128, 0.5); ">
                    <div style="overflow-y: scroll; height: 550px;">
                        <table>
                            <tbody>
                                {% for noti in lista_presupuestos%}
                                <tr style="border-bottom: 0px; ">
                                    <td class="opcion center">{{noti.titulo}} {{noti.timestamp|date:"M d, Y"}}</td>
                                    <td><a class="btn-floating btn-small waves-effect waves-light red "
                                            onclick="detalleNotis('{{noti.id}}')"><i
                                                class=" small material-icons ">search</i></a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <!----------------------------------->
                <!-----------------notificaciones logistica ------------------>
                <div class="col s4 tamaño bloque-centro1" style="border-bottom: 2px solid rgb(128, 128, 128, 0.5);">
                    <div style="overflow-y: scroll; height: 550px;">
                        <table>
                            <tbody>
                                {% for noti in lista_logistica_noti %}
                                <tr style="border-bottom: 0px; ">
                                    <td class="opcion center">{{noti.titulo}} {{noti.timestamp|date:"M d, Y"}}</td>
                                    <td><a class="btn-floating btn-small waves-effect waves-light red "
                                            onclick="detalleNotis('{{noti.id}}')"><i
                                                class=" small material-icons ">search</i></a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <!----------------------------------->

                <!-------------notificaciones vencmientos ---------------------->

                <div class="col  s4 tamaño" style="border-bottom:2px solid rgb(128, 128, 128, 0.5);">
                    <div style="overflow-y: scroll; height: 550px;">
                        <table>
                            <tbody>
                                {% for noti in lista_vencimiento%}
                                <tr style="border-bottom: 0px; ">
                                    <td class="opcion center">{{noti.titulo}} {{noti.timestamp|date:"M d, Y"}} </td>
                                    <td><a class="btn-floating btn-small waves-effect waves-light red"
                                            onclick="detalleNotis('{{noti.id}}')"><i
                                                class=" small material-icons ">search</i></a></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <!----------------------------------->
                <div class="col s12 " style="height: 70px; border-top: 1px solid rgb(128, 128, 128, 0.5); "></div>
            </div>

        </div>
</body>
<script>
    $(document).ready(function () {
        $('select').formSelect();
    });

    $(document).ready(function () {
        $('.datepicker').datepicker();
    });

    $(document).ready(function () {
        $('input#input_text, textarea#textarea2').characterCounter();
    });

    function searchBuscadorNegocio() {
        var value = $("#inputBuscadorNegocio").val().toLowerCase();
        $("#tableNegocios tr").filter(function () {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
        });
    };

    function detalleNegocio(idProp) {
        $.ajax({
            type: 'POST',
            url: "{% url 'detalleNegocio' %}",
            data: {
                'idProp': idProp,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (data) {
                $("#modalNegocio").html(data);
                $('#modalDetalleNegocio').modal('open');
            },
            error: function (response) {
                console.log("Error")
            }
        })
    };

    function detalleArticuloNegocio(idItem, funOrig) {
        $.ajax({
            type: 'POST',
            url: "{% url 'detalleItem' %}",
            data: {
                'idItem': idItem,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (data) {
                $("#modalNegocio").html(data);
                $('#modalDetalleNegocio').modal('open');
            },
            error: function (response) {
                console.log("Error")
            }
        })
    };

    function selTipoFecha() {
        var x = $('#selectTipoFecha').val();
        y = document.getElementById("divFechasParam");
        if (x == "0") {
            y.style.display = "none";
        } else {
            y.style.display = "block";
        }
    }

    function filtrar() {
        var errores = 0;
        var vendedores = $('#selectVendedores').val();
        var vendedor = JSON.stringify(vendedores);
        if (vendedor.length <= 2) {
            M.toast({ html: 'Error! El filtro Vendedor no puede estar en blanco.' });
            errores = 1;
        };
        var estaV = vendedores.includes("todos");
        if (estaV) {
            vendedor = "todos";
        };
        var estados = $('#selectEstados').val();
        var estado = JSON.stringify(estados);
        if (estado.length <= 2) {
            M.toast({ html: 'Error! El filtro Estado no puede estar en blanco.' });
            errores = 1;
        }
        var estaE = estados.includes("todos");
        if (estaE) {
            estado = "todos";
        };
        var tipo = $('#selectTipo').val();
        var tipoFecha = $('#selectTipoFecha').val();
        var fechaDesde = $('#fechaDesde').val();
        var fechaHasta = $('#fechaHasta').val();
        if (tipoFecha != "0") {
            if (fechaDesde === "") {
                M.toast({ html: 'Error! "Fecha Desde" no puede estar en blanco.' });
                errores = 1;
            };
            if (fechaHasta === "") {
                M.toast({ html: 'Error! "Fecha Hasta" no puede estar en blanco.' });
                errores = 1;
            };
        };
        if (errores == 0) {
            $.ajax({
                url: "{% url 'filtrarNegocios' %}",
                type: 'POST',
                data: {
                    'vendedor': vendedor, 'estado': estado, 'tipo': tipo,
                    'tipoFecha': tipoFecha, 'fechaDesde': fechaDesde, 'fechaHasta': fechaHasta,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (data) {
                    $('#infoTabla').html(data);
                },
                error: function (data) {
                    console.log(data)
                }
            });
        };
    }


</script>
{% endblock body %}